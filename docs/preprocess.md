# 数据预处理

## 数据来源

我们的例子事件在 IRIS 上的事件编号是 2725882。事件信息为： 2008 年 4 月 18 日 9 时 36 分 58 秒，震中北纬 38.4584 度，西经 87.8398度，震源深度 15.8 公里，震级 5.4。

我们通过 IRIS Wilber 系统申请了波形数据，即文件 `example/20080418093658/20080418093658.seed`，seed文件包含了波形记录和仪器响应。
在 `example/20080418093658/` 下还有一个 `info` 文件：

    2008-04-18T09:36:58 38.4584 -87.8398 15.8 5.4

含义为：发震时刻、震中纬度、经度、震源深度和震级。

也就是说这里的 seed 文件和文件 `info` 就包含了需要的全部信息。下面说明数据预处理的各个步骤。

## 数据的处理

数据的处理是通过运行 `example/` 下的脚本 `process.pl` 来完成的：

    perl process.pl 20080418093658

其中，参数 20080418093658 就是指的相应路径。`process.pl` 运行后会依次调用其他脚本，并把这个路径传递给相应脚本，下面依次说明各脚本做了什么。

### rdseed.pl

`rdseed.pl` 依次做以下三件事：

1. 从事件路径下所有 seed 文件中提取出 SAC 文件和 RESP 文件
2. 如果某台站的数据因故分割为了多个，则进行合并
3. 将 SAC 文件名重命名为 `NET.STATION.LOCCAL.CHANNEL.SAC` 的形式

### eventinfo.pl

`eventinfo.pl` 同步所有 SAC 文件的参考时刻，并读取文件 `info`，把事件信息写入 SAC 文件。

### marktime.pl

`marktime.pl` 根据事件信息和台站位置，把 Pnl 波的理论到时写进 SAC 文件的头段变量 T0 中。
这一步，依赖于外部程序 taup。标记理论到时并不是必须的，这个问题会在反演部分再详细说明。

### transfer.pl

`transfer` 依次做以下三件事：

1. 去毛刺、去均值、去线性趋势和波形尖灭
2. 去仪器响应，使 y 轴表示速度
3. 改单位由默认的 nm/s 为 cm/s

### rotate.pl

`rotate.pl` 将所有台站的三分量转到大圆路径。

### resample.pl

`resample.pl` 对数据进行重采样。`resample.pl` 需要重采样的采样周期为参数，这里我们使用的是 0.2s。
需要强调的是，所有 SAC 文件的采样周期必须相同，并且要和之后计算格林函数时的参数 dt 相同。这一点是程序设计的要求。